<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Gestionale Malusci Camp</title>

  <link rel="stylesheet" href="css/dashboard.css">
  <link rel="stylesheet" href="css/header.css">

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- Icone -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

<!-- HEADER -->
<div id="header"></div>

<div class="dashboard-container">

  <h1 class="dashboard-title">DASHBOARD ADMIN</h1>

  <div class="dashboard-grid">

    <div class="card utenti" onclick="goTo('utenti.html')">
      <i class="fa-solid fa-users"></i>
      <h2>Crea Utenti</h2>
    </div>

    <div class="card settimane" onclick="openSettimanaPopup()">
      <i class="fa-solid fa-calendar-days"></i>
      <h2>Crea Settimane Camp</h2>
    </div>

    <div class="card girls" onclick="goTo('girlcamp.html')">
      <i class="fa-solid fa-futbol"></i>
      <h2>Girls Soccer Camp</h2>
    </div>

   <div class="card maschile" onclick="goTo('boys-camp.html')">
  <i class="fa-solid fa-futbol"></i>
  <h2>Boys Soccer Camp</h2>
</div>

  </div>

  <hr class="divider">

  <h2 class="section-title">Settimane Create</h2>
  <div id="settimaneContainer" class="settimane-container"></div>

  <button class="logout-btn" onclick="logout()">LOGOUT</button>

</div>

<!-- POPUP CREA SETTIMANA -->
<div id="settimanaModal" class="modal">
  <div class="modal-content">
    <h2>Crea Settimana Camp</h2>

    <select id="campSettimana">
  <option value="girls">Girls Camp</option>
  <option value="boys">Boys Camp</option>
</select>

    <input type="text" id="nomeSettimana" placeholder="Nome settimana">

    <label>Dal:</label>
    <input type="date" id="dataDal">

    <label>Al:</label>
    <input type="date" id="dataAl">

    <input type="number" id="prezzo" placeholder="Prezzo â‚¬">

    <div class="modal-buttons">
      <button onclick="salvaSettimana()">Salva</button>
      <button class="close-btn" onclick="closeSettimanaPopup()">Chiudi</button>
    </div>
  </div>
</div>

<script>

  // ===============================
  // FIREBASE CONFIG
  // ===============================
  const firebaseConfig = {
    apiKey: "AIzaSyDVomjMP2gDUy_mEIe-tnVf4hEdF7GFvws",
    authDomain: "gestionale-maluscicamp.firebaseapp.com",
    projectId: "gestionale-maluscicamp",
    storageBucket: "gestionale-maluscicamp.appspot.com",
    messagingSenderId: "615282026849",
    appId: "1:615282026849:web:bf46adfca227570d7d7d20"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  const db = firebase.firestore();


  // ===============================
  // NAVIGAZIONE
  // ===============================
  function goTo(page) {
    window.location.href = page;
  }

  function logout() {
    window.location.href = "index.html";
  }

  function goDashboard() {
    window.location.href = "dashboard.html";
  }

  function goBack() {
    window.history.back();
  }


  // ===============================
  // HEADER LOAD
  // ===============================
  fetch("components/header.html")
    .then(res => res.text())
    .then(data => {
      document.getElementById("header").innerHTML = data;
    });


  // ===============================
  // POPUP
  // ===============================
  function openSettimanaPopup() {
    document.getElementById("settimanaModal").style.display = "flex";
  }

  function closeSettimanaPopup() {
    document.getElementById("settimanaModal").style.display = "none";
  }


  // ===============================
  // SALVA SETTIMANA
  // ===============================
  function salvaSettimana() {

    const camp = document.getElementById("campSettimana").value;
    const nome = document.getElementById("nomeSettimana").value.trim();
    const dal = document.getElementById("dataDal").value;
    const al = document.getElementById("dataAl").value;
    const prezzo = Number(document.getElementById("prezzo").value);

    if (!nome || !dal || !al || !prezzo) {
      alert("Compila tutti i campi");
      return;
    }

    db.collection("settimane").add({
      nome: nome,
      dal: dal,
      al: al,
      prezzo: prezzo,
      camp: camp,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then((docRef) => {

      creaCardSettimana({
        id: docRef.id,
        nome,
        dal,
        al,
        camp
      });

      closeSettimanaPopup();

      document.getElementById("nomeSettimana").value = "";
      document.getElementById("dataDal").value = "";
      document.getElementById("dataAl").value = "";
      document.getElementById("prezzo").value = "";

    })
    .catch((error) => {
      console.error("Errore:", error);
      alert("Errore salvataggio: " + error.message);
    });
  }


  // ===============================
  // CREA CARD SETTIMANA
  // ===============================
  function creaCardSettimana(data) {

    const container = document.getElementById("settimaneContainer");

    const card = document.createElement("div");
    card.className = "settimana-card";

    // ðŸ”¥ COLORI DINAMICI

    if(data.camp === "girls"){
      card.classList.add("card-girls");
    }

    if(data.camp === "boys"){

      const nome = data.nome.toLowerCase();

      if(nome.includes("rossa")){
        card.classList.add("card-rossa");
      }
      else if(nome.includes("bianca")){
        card.classList.add("card-bianca");
      }
      else if(nome.includes("azzurra")){
        card.classList.add("card-azzurra");
      }
      else if(nome.includes("verde")){
        card.classList.add("card-verde");
      }
      else{
        card.classList.add("card-boys-default");
      }
    }

    card.onclick = function() {
      window.location.href = "settimana.html?id=" + data.id;
    };

    card.innerHTML = `
      <h3>${data.nome}</h3>
      <p><strong>Periodo:</strong> ${data.dal} - ${data.al}</p>
      <small>${data.camp.toUpperCase()}</small>
    `;

    container.appendChild(card);
  }


  // ===============================
  // CARICA SETTIMANE ALL'AVVIO
  // ===============================
  window.onload = function() {

    db.collection("settimane")
      .orderBy("createdAt")
      .get()
      .then((querySnapshot) => {

        querySnapshot.forEach((doc) => {

          const data = doc.data();

          creaCardSettimana({
            id: doc.id,
            nome: data.nome,
            dal: data.dal,
            al: data.al,
            camp: data.camp
          });

        });

      });

  };

</script>

</body>
</html>