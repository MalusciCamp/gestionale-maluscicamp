<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Riepilogo Anno</title>

  <link rel="stylesheet" href="css/dashboard.css">
  <link rel="stylesheet" href="css/header.css">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>

<!-- HEADER PUBBLICO -->
<div id="header"></div>

<div class="dashboard-container">

  <h1 id="titoloAnno"></h1>

  <div id="containerSettimane" class="settimane-container"></div>

</div>

<script src="js/firebase-config.js"></script>

<script>

// ================= HEADER LOAD =================
fetch("components/header.html")
  .then(res => res.text())
  .then(data => {
    document.getElementById("header").innerHTML = data;
  });


// ================= PARAMETRO ANNO =================
const params = new URLSearchParams(window.location.search);
const anno = params.get("anno");

document.getElementById("titoloAnno").innerText =
  "RIEPILOGO " + anno + " - SETTIMANE CONCLUSE";

const oggi = new Date();


// ================= CARICA SETTIMANE CONCLUSE =================
db.collection("settimane")
  .get()
  .then(snapshot => {

    snapshot.forEach(doc => {

      const data = doc.data();
      const dataFine = new Date(data.al);

      if(
        dataFine.getFullYear() == anno &&
        dataFine < oggi
      ){

        creaCardSettimana({
          id: doc.id,
          nome: data.nome,
          dal: data.dal,
          al: data.al,
          camp: data.camp
        });

      }

    });

  });


// ================= CREA CARD (CON COLORI DINAMICI) =================
function creaCardSettimana(data){

  const container = document.getElementById("containerSettimane");

  const card = document.createElement("div");
  card.className = "settimana-card";

  // ðŸ”¥ COLORI DINAMICI (UGUALI ALLA DASHBOARD)

  if(data.camp === "girls"){
    card.classList.add("card-girls");
  }

  if(data.camp === "boys"){

    const nome = data.nome.toLowerCase();

    if(nome.includes("ross")){
      card.classList.add("card-rossa");
    }
    else if(nome.includes("arancio") || nome.includes("arancione")){
      card.classList.add("card-arancio");
    }
    else if(nome.includes("gial")){
      card.classList.add("card-giallo");
    }
    else if(nome.includes("azzurr")){
      card.classList.add("card-azzurro");
    }
    else if(nome.includes("blu")){
      card.classList.add("card-blu");
    }
    else if(nome.includes("bian")){
      card.classList.add("card-bianco");
    }
    else if(nome.includes("verd")){
      card.classList.add("card-verde");
    }
    else{
      card.classList.add("card-boys-default");
    }
  }

  // ================= DATA FORMATTATA =================
  const dalFormattato = formattaDataIT(data.dal);
  const alFormattato = formattaDataIT(data.al);

  card.innerHTML = `
    <h3>${data.nome}</h3>
    <p><strong>Periodo:</strong> ${dalFormattato} - ${alFormattato}</p>
    <small>${data.camp.toUpperCase()}</small>
  `;

  card.onclick = function(){
    window.location.href = "settimana.html?id=" + data.id;
  };

  container.appendChild(card);
}


// ================= FORMATTA DATA =================
function formattaDataIT(data){
  if(!data) return "";
  const d = new Date(data);
  return d.toLocaleDateString("it-IT");
}

</script>
<script>
function goDashboard() {
  window.location.href = "dashboard.html";
}

function goBack() {
  window.history.back();
}
</script>
</body>
</html>

